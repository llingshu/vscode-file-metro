(()=>{"use strict";var e={265:function(e,t,n){var r,o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),s=0;s<n.length;s++)"default"!==n[s]&&o(t,e,n[s]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.activate=function(e){const t=new c.FileTracker;e.subscriptions.push(a.commands.registerCommand("metro.open",()=>{u.MetroViewPanel.createOrShow(e.extensionUri,t)})),e.subscriptions.push(a.workspace.onDidRenameFiles(e=>{e.files.forEach(e=>{t.handleFileRename(e.oldUri.fsPath,e.newUri.fsPath)&&u.MetroViewPanel.currentPanel&&u.MetroViewPanel.currentPanel.updateLayout(t.getLayout())})})),e.subscriptions.push(a.workspace.onDidDeleteFiles(e=>{e.files.forEach(e=>{t.handleFileDelete(e.fsPath)&&u.MetroViewPanel.currentPanel&&u.MetroViewPanel.currentPanel.updateLayout(t.getLayout())})}))},t.deactivate=function(){};const a=s(n(398)),c=n(894),u=n(632)},295:(e,t,n)=>{n.r(t),n.d(t,{MAX:()=>r,NIL:()=>o,parse:()=>a,stringify:()=>l,v1:()=>v,v1ToV6:()=>g,v3:()=>U,v4:()=>j,v5:()=>M,v6:()=>S,v6ToV1:()=>k,v7:()=>I,validate:()=>s,version:()=>E});const r="ffffffff-ffff-ffff-ffff-ffffffffffff",o="00000000-0000-0000-0000-000000000000",i=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i,s=function(e){return"string"==typeof e&&i.test(e)},a=function(e){if(!s(e))throw TypeError("Invalid UUID");let t;return Uint8Array.of((t=parseInt(e.slice(0,8),16))>>>24,t>>>16&255,t>>>8&255,255&t,(t=parseInt(e.slice(9,13),16))>>>8,255&t,(t=parseInt(e.slice(14,18),16))>>>8,255&t,(t=parseInt(e.slice(19,23),16))>>>8,255&t,(t=parseInt(e.slice(24,36),16))/1099511627776&255,t/4294967296&255,t>>>24&255,t>>>16&255,t>>>8&255,255&t)},c=[];for(let e=0;e<256;++e)c.push((e+256).toString(16).slice(1));function u(e,t=0){return(c[e[t+0]]+c[e[t+1]]+c[e[t+2]]+c[e[t+3]]+"-"+c[e[t+4]]+c[e[t+5]]+"-"+c[e[t+6]]+c[e[t+7]]+"-"+c[e[t+8]]+c[e[t+9]]+"-"+c[e[t+10]]+c[e[t+11]]+c[e[t+12]]+c[e[t+13]]+c[e[t+14]]+c[e[t+15]]).toLowerCase()}const l=function(e,t=0){const n=u(e,t);if(!s(n))throw TypeError("Stringified UUID is invalid");return n},f=require("node:crypto"),d=new Uint8Array(256);let h=d.length;function p(){return h>d.length-16&&((0,f.randomFillSync)(d),h=0),d.slice(h,h+=16)}const y={};function w(e,t,n,r,o,i,s=0){if(e.length<16)throw new Error("Random bytes length must be >= 16");if(i){if(s<0||s+16>i.length)throw new RangeError(`UUID byte range ${s}:${s+15} is out of buffer bounds`)}else i=new Uint8Array(16),s=0;t??=Date.now(),n??=0,r??=16383&(e[8]<<8|e[9]),o??=e.slice(10,16);const a=(1e4*(268435455&(t+=122192928e5))+n)%4294967296;i[s++]=a>>>24&255,i[s++]=a>>>16&255,i[s++]=a>>>8&255,i[s++]=255&a;const c=t/4294967296*1e4&268435455;i[s++]=c>>>8&255,i[s++]=255&c,i[s++]=c>>>24&15|16,i[s++]=c>>>16&255,i[s++]=r>>>8|128,i[s++]=255&r;for(let e=0;e<6;++e)i[s++]=o[e];return i}const v=function(e,t,n){let r;const o=e?._v6??!1;if(e){const t=Object.keys(e);1===t.length&&"_v6"===t[0]&&(e=void 0)}if(e)r=w(e.random??e.rng?.()??p(),e.msecs,e.nsecs,e.clockseq,e.node,t,n);else{const e=Date.now(),i=p();!function(e,t,n){e.msecs??=-1/0,e.nsecs??=0,t===e.msecs?(e.nsecs++,e.nsecs>=1e4&&(e.node=void 0,e.nsecs=0)):t>e.msecs?e.nsecs=0:t<e.msecs&&(e.node=void 0),e.node||(e.node=n.slice(10,16),e.node[0]|=1,e.clockseq=16383&(n[8]<<8|n[9])),e.msecs=t}(y,e,i),r=w(i,y.msecs,y.nsecs,o?void 0:y.clockseq,o?void 0:y.node,t,n)}return t??u(r)};function g(e){const t=function(e){return Uint8Array.of((15&e[6])<<4|e[7]>>4&15,(15&e[7])<<4|(240&e[4])>>4,(15&e[4])<<4|(240&e[5])>>4,(15&e[5])<<4|(240&e[0])>>4,(15&e[0])<<4|(240&e[1])>>4,(15&e[1])<<4|(240&e[2])>>4,96|15&e[2],e[3],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}("string"==typeof e?a(e):e);return"string"==typeof e?u(t):t}const m=function(e){return Array.isArray(e)?e=Buffer.from(e):"string"==typeof e&&(e=Buffer.from(e,"utf8")),(0,f.createHash)("md5").update(e).digest()},b="6ba7b810-9dad-11d1-80b4-00c04fd430c8",_="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function P(e,t,n,r,o,i){const s="string"==typeof n?function(e){e=unescape(encodeURIComponent(e));const t=new Uint8Array(e.length);for(let n=0;n<e.length;++n)t[n]=e.charCodeAt(n);return t}(n):n,c="string"==typeof r?a(r):r;if("string"==typeof r&&(r=a(r)),16!==r?.length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let l=new Uint8Array(16+s.length);if(l.set(c),l.set(s,c.length),l=t(l),l[6]=15&l[6]|e,l[8]=63&l[8]|128,o){i=i||0;for(let e=0;e<16;++e)o[i+e]=l[e];return o}return u(l)}function O(e,t,n,r){return P(48,m,e,t,n,r)}O.DNS=b,O.URL=_;const U=O,L={randomUUID:f.randomUUID},j=function(e,t,n){return!L.randomUUID||t||e?function(e,t,n){const r=(e=e||{}).random??e.rng?.()??p();if(r.length<16)throw new Error("Random bytes length must be >= 16");if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){if((n=n||0)<0||n+16>t.length)throw new RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[n+e]=r[e];return t}return u(r)}(e,t,n):L.randomUUID()},F=function(e){return Array.isArray(e)?e=Buffer.from(e):"string"==typeof e&&(e=Buffer.from(e,"utf8")),(0,f.createHash)("sha1").update(e).digest()};function D(e,t,n,r){return P(80,F,e,t,n,r)}D.DNS=b,D.URL=_;const M=D,S=function(e,t,n){e??={},n??=0;let r=v({...e,_v6:!0},new Uint8Array(16));if(r=g(r),t){for(let e=0;e<16;e++)t[n+e]=r[e];return t}return u(r)};function k(e){const t=(n="string"==typeof e?a(e):e,Uint8Array.of((15&n[3])<<4|n[4]>>4&15,(15&n[4])<<4|(240&n[5])>>4,(15&n[5])<<4|15&n[6],n[7],(15&n[1])<<4|(240&n[2])>>4,(15&n[2])<<4|(240&n[3])>>4,16|(240&n[0])>>4,(15&n[0])<<4|(240&n[1])>>4,n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15]));var n;return"string"==typeof e?u(t):t}const T={};function x(e,t,n,r,o=0){if(e.length<16)throw new Error("Random bytes length must be >= 16");if(r){if(o<0||o+16>r.length)throw new RangeError(`UUID byte range ${o}:${o+15} is out of buffer bounds`)}else r=new Uint8Array(16),o=0;return t??=Date.now(),n??=127*e[6]<<24|e[7]<<16|e[8]<<8|e[9],r[o++]=t/1099511627776&255,r[o++]=t/4294967296&255,r[o++]=t/16777216&255,r[o++]=t/65536&255,r[o++]=t/256&255,r[o++]=255&t,r[o++]=112|n>>>28&15,r[o++]=n>>>20&255,r[o++]=128|n>>>14&63,r[o++]=n>>>6&255,r[o++]=n<<2&255|3&e[10],r[o++]=e[11],r[o++]=e[12],r[o++]=e[13],r[o++]=e[14],r[o++]=e[15],r}const I=function(e,t,n){let r;if(e)r=x(e.random??e.rng?.()??p(),e.msecs,e.seq,t,n);else{const e=Date.now(),o=p();!function(e,t,n){e.msecs??=-1/0,e.seq??=0,t>e.msecs?(e.seq=n[6]<<23|n[7]<<16|n[8]<<8|n[9],e.msecs=t):(e.seq=e.seq+1|0,0===e.seq&&e.msecs++)}(T,e,o),r=x(o,T.msecs,T.seq,t,n)}return t??u(r)},E=function(e){if(!s(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)}},398:e=>{e.exports=require("vscode")},632:function(e,t,n){var r,o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),s=0;s<n.length;s++)"default"!==n[s]&&o(t,e,n[s]);return i(t,e),t}),a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.MetroViewPanel=void 0;const c=s(n(398)),u=s(n(896)),l=s(n(928));class f{static createOrShow(e,t){const n=c.window.activeTextEditor?c.window.activeTextEditor.viewColumn:void 0;if(f.currentPanel)return void f.currentPanel._panel.reveal(n);const r=c.window.createWebviewPanel(f.viewType,"Metro View",n||c.ViewColumn.One,{enableScripts:!0,localResourceRoots:[c.Uri.joinPath(e,"dist")]});f.currentPanel=new f(r,e,t)}constructor(e,t,n){this._disposables=[],this._panel=e,this._extensionUri=t,this._fileTracker=n,this._update(),this._panel.onDidDispose(()=>this.dispose(),null,this._disposables),this._panel.webview.onDidReceiveMessage(e=>{switch(e.command){case"saveLayout":return void this._fileTracker.saveLayout(e.layout);case"openFile":return void c.commands.executeCommand("vscode.open",c.Uri.file(e.filePath));case"createNote":return this._fileTracker.createNote(e.position),void this.updateLayout(this._fileTracker.getLayout());case"renameNode":return void c.window.showInputBox({prompt:"Enter new name",value:l.basename(e.oldPath)}).then(t=>{t&&(this._fileTracker.renameFile(e.id,e.oldPath,t),this.updateLayout(this._fileTracker.getLayout()))});case"webviewReady":return void this.updateLayout(this._fileTracker.getLayout())}},null,this._disposables)}updateLayout(e){this._panel.webview.postMessage({command:"updateLayout",layout:e})}openFile(e){return a(this,void 0,void 0,function*(){c.window.showInformationMessage(`Attempting to open: ${e}`);try{if(!u.existsSync(e))return void c.window.showErrorMessage(`File not found: ${e}`);const t=c.Uri.file(e),n=yield c.workspace.openTextDocument(t);yield c.window.showTextDocument(n)}catch(e){console.error("Failed to open file:",e),c.window.showErrorMessage(`Failed to open file: ${e instanceof Error?e.message:String(e)}`)}})}dispose(){for(f.currentPanel=void 0,this._panel.dispose();this._disposables.length;){const e=this._disposables.pop();e&&e.dispose()}}_update(){const e=this._panel.webview;this._panel.webview.html=this._getHtmlForWebview(e)}_getHtmlForWebview(e){const t=e.asWebviewUri(c.Uri.joinPath(this._extensionUri,"dist","webview.js")),n=function(){let e="";const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let n=0;n<32;n++)e+=t.charAt(Math.floor(62*Math.random()));return e}();return`<!DOCTYPE html>\n            <html lang="en">\n            <head>\n                <meta charset="UTF-8">\n                <meta name="viewport" content="width=device-width, initial-scale=1.0">\n                <title>Metro View</title>\n                <style>\n                    body { padding: 0; margin: 0; width: 100%; height: 100vh; overflow: hidden; }\n                </style>\n                <script nonce="${n}">\n                    window.initialConfig = {\n                        showInactiveStations: ${c.workspace.getConfiguration("metro").get("showInactiveStations",!0)}\n                    };\n                <\/script>\n            </head>\n            <body>\n                <div id="root" style="width: 100%; height: 100%;"></div>\n                <script nonce="${n}" src="${t}"><\/script>\n            </body>\n            </html>`}}t.MetroViewPanel=f,f.viewType="metroView"},894:function(e,t,n){var r,o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=r(e),s=0;s<n.length;s++)"default"!==n[s]&&o(t,e,n[s]);return i(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.FileTracker=void 0;const a=s(n(398)),c=s(n(896)),u=s(n(928)),l=n(295);t.FileTracker=class{constructor(){this.currentLayout={nodes:[],groups:[],edges:[]},this.initialize()}initialize(){if(a.workspace.workspaceFolders&&a.workspace.workspaceFolders.length>0){const e=a.workspace.workspaceFolders[0].uri.fsPath,t=u.join(e,".vscode");c.existsSync(t)||c.mkdirSync(t),this.layoutFilePath=u.join(t,"metro-layout.json"),this.loadLayout()}}createNote(e){if(!a.workspace.workspaceFolders)return;const t=a.workspace.workspaceFolders[0].uri.fsPath,n=u.join(t,".Note");c.existsSync(n)||c.mkdirSync(n);const r=`Note_${(new Date).toISOString().replace(/[:.]/g,"-")}.md`,o=u.join(n,r);c.writeFileSync(o,"# New Note\n");const i={id:(0,l.v4)(),type:"note",filePath:o,position:e,label:r,status:"active"};return this.currentLayout.nodes.push(i),this.saveLayout(this.currentLayout),i}loadLayout(){if(this.layoutFilePath&&c.existsSync(this.layoutFilePath))try{const e=c.readFileSync(this.layoutFilePath,"utf-8");this.currentLayout=JSON.parse(e),this.checkFiles()}catch(e){console.error("Failed to load metro layout:",e)}return this.currentLayout}saveLayout(e){this.currentLayout=e,this.layoutFilePath&&c.writeFileSync(this.layoutFilePath,JSON.stringify(e,null,2))}getLayout(){return this.currentLayout}checkFiles(){let e=!1;this.currentLayout.nodes.forEach(t=>{if("file"===t.type){const n=c.existsSync(t.filePath)?"active":"missing";t.status!==n&&(t.status=n,e=!0)}}),e&&this.saveLayout(this.currentLayout)}handleFileRename(e,t){let n=!1;return this.currentLayout.nodes.forEach(r=>{r.filePath===e&&(r.filePath=t,r.label=u.basename(t),r.status="active",n=!0)}),n&&this.saveLayout(this.currentLayout),n}handleFileDelete(e){let t=!1;return this.currentLayout.nodes.forEach(n=>{n.filePath===e&&(n.status="missing",t=!0)}),t&&this.saveLayout(this.currentLayout),t}renameFile(e,t,n){const r=u.dirname(t),o=u.join(r,n);try{c.renameSync(t,o);const r=this.currentLayout.nodes.find(t=>t.id===e);r&&(r.filePath=o,r.label=n,this.saveLayout(this.currentLayout))}catch(e){a.window.showErrorMessage(`Failed to rename file: ${e}`)}}}},896:e=>{e.exports=require("fs")},928:e=>{e.exports=require("path")}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r=n(265),o=exports;for(var i in r)o[i]=r[i];r.__esModule&&Object.defineProperty(o,"__esModule",{value:!0})})();